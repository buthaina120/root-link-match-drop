<div *ngIf="flag" class="container" style="background-color: #f8f8f8">
  <div class="row justify-content-center text-center">
    <!-- الشعار -->
    <div class="col-12">
      <img
        src="../../../angular/assets/linkLogo.png"
        alt="شعار اللعبة"
        class="logo"
        style="width: 300px; height: auto"
      />
    </div>

    <!-- زر ابدأ -->
    <div (click)="startGame(); " class="col-12 ">
      <button pButton type="button" class="text-2xl bg-sec-theme px-4 mt-3">
        ابدأ
      </button>
    </div>

    <!-- أزرار التحكم -->
    <div class="col-12">
      <div class="d-flex justify-content-center">
        <button
          pButton
          type="button"
          pTooltip="تعليمات اللعبة"
          tooltipPosition="bottom"
          class="bg-sec-theme p-2 m-2"
          (click)="showInstructions()"
        >
          <i class="pi pi-question-circle"></i>
        </button>
      </div>
    </div>

    <p-dialog
      class=""
      [(visible)]="display"
      modal="modal"
      [responsive]="true"
      [style]="{ width: '90%', maxWidth: '650px', color: 'black' }"
      [styleClass]="'custom-dialog'"
    >
      <p class="text-2xl font-bold">تعليمات لعبة جذر</p>
      <p>هدف اللعبة: توصيل خط متصل من الخلايا الملونة بلونك الخاص!​</p>

      <div class="row">
        <div class=" col-md-12">
          <p-card
            styleClass="custom-card align-items-right "
            [style]="{
              width:'100%',
              minHeight: '250px',
              height: 'auto',
              border: '2px',
              borderRadius: '15px',
              backgroundColor: '#f8f8f8',
              color: 'black',
              boxShadow:
                '0 0px 0px 0px rgba(0, 0, 0, 0), 0 0px 0px 0 rgba(0, 0, 0, 0), 0 0px 0px 0 rgba(0, 0, 0, 0)',
            }"
          >
          <div class="text-right">
            <p>
              1. اسناد اللون: سيسند لون مخصلل لكل لاعب (أخضر || كحلي).
            </p>
            <p>2. بدء اللعبة: يبدأ اللاعب الأول باختيار حرف من اللوحة.</p>
            <p>3. طرح السؤال: يُطرح سؤال يبدأ جوابه بالحرف المختار.</p>
            <p>4. بعد اللإجابة بشكل صحيح، تتلون الخلية بلونه ثم ينتقل الدور للاعب الآخر.</p>
            <p>5. الفوز: أول لاعب يربط بين ناحيتي اللوحة بخط متصل من الخلايا الملونة بلونه يفوز باللعبة!</p>
          </div>
          </p-card>
        </div>
    
      </div>
      <div class="m-4 font-bold">
        <p>
          استمتع باللعب، واستعد لتحسين مهاراتك اللغوية بطريقة ممتعة ومثيرة!
        </p>
      </div>
    </p-dialog>

  

    <p-dialog [(visible)]="isPlayerNameDialogVisible" [style]="{ width: '25rem' }" class="gap-2" closable="false" >
      <p class="text-2xl font-bold">أدخل أسماء اللاعبين</p>
      
      <div class="flex align-items-center gap-3 my-4">
        <input pInputText [(ngModel)]="greenPlayerName" id="player1Name" class="flex-auto py-2" autocomplete="off" placeholder="اسم اللاعب الأول"  />
      </div>
      <p *ngIf="greenPlayerNameRequired" class="requiredMSG animate__animated  animate__fadeInDown">* يرجى ادخال الاسم</p>

      <div class="flex align-items-center gap-3 mb-4">
        <input pInputText [(ngModel)]="navyPlayerName" id="player2Name" class="flex-auto py-2" autocomplete="off" placeholder="اسم اللاعب الثاني" required/>
      </div>
      <p *ngIf="navePlayerNameRequired" class="requiredMSG animate__animated  animate__fadeInDown">* يرجى ادخال الاسم</p>

      <div class="flex justify-content-center gap-2">
        <button 
          type="submit"
          pButton
          label="حفظ"
          class="px-4 m-2 p-button p-component text-xl bg-sec-theme"
          (click)="startGame() ; requiredMsg() "
        >
        </button>
      </div>
    </p-dialog>

  </div>
</div>

<div *ngIf="!flag" class="container">
<div style="text-align: center;" class="game-container" [ngStyle]="{ 'border': currentPlayer === green ? '5px solid #52a39d' : '5px solid rgba(15, 40, 55, 0.8)' }">
  <h1>تحدي صِـــــل</h1>

  
  <div class="players-container animate__animated animate__bounceInRight" *ngIf="playersSet" >
    <div 
      class="player-box animate__animated animate__bounceInRight" 
      [style.opacity]="currentPlayer === green ? '1' : '0.5'" 
      [style.background-color]="green">
      {{ greenPlayerName }}
    </div>
    <div class="divider">-</div>
    <div 
      class="player-box animate__animated animate__bounceInLeft" 
      [style.opacity]="currentPlayer === navy ? '1' : '0.5'" 
      [style.background-color]="navy">
      {{ navyPlayerName }}
    </div>
  </div>
  
  
  
  <svg xmlns="http://www.w3.org/2000/svg" [attr.viewBox]="'-45 -43 400 325'" id="hex-grid">
    <!-- الشبكة السداسية -->
    <ng-container *ngFor="let cell of grid; let index = index" >
      <polygon 
        [attr.id]="cell.id"
        [attr.points]="cell.points"
        stroke="lightgray"
        [attr.fill]="cell.color || 'white'"
        (click)="handleCellClick(cell, index)"
        style="cursor: pointer;"
      ></polygon>
      <text
        [attr.x]="getTextPosition(cell.points).x"
        [attr.y]="getTextPosition(cell.points).y"
        text-anchor="middle"
        dominant-baseline="middle"
        font-size="16"
        [attr.fill]="cell.color ? 'white' : 'black'">
        {{ cell.letter }}
      </text>
    </ng-container>
  </svg>


  <!-- عرض الفائز -->
  <div *ngIf="winner" class="auto-text animate__animated animate__tada">
    الفائز: <span [style.color]="winner">{{ winner === green ? greenPlayerName : navyPlayerName }}</span>
  </div>
  

</div>
    <!-- عرض السؤال -->
    <div *ngIf="currentQuestion" class="question-modal">
      <div class="auto-text">{{ currentQuestion.question }}</div>
      <div class="options" >
        <button
        *ngFor="let option of currentQuestion?.options"
        [ngClass]="{
          'animate__animated animate__headShake': wrongAnswerOption === option,
          'animate__animated animate__fadeIn': correctAnswerOption === option,
        }"
        [ngStyle]="{
          'border': 
            correctAnswerOption === option 
              ? '2px solid green' : 
            wrongAnswerOption === option 
              ? '2px solid red' : 
              '1px solid #ddd',
          'border-radius': '5px',
          'pointer-events': isAnswered ? 'none' : 'auto' 

        }"
            (click)="checkAnswer(option)"
          >
            {{ option }}
      </button>
      
      
      </div>
    </div>

  </div>